<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Faculty Syllabus Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <style>
    .hover-actions:hover .action-btn { opacity: 1; }
    .action-btn { opacity: 0; transition: opacity 0.2s; }
    .fade-section { transition: all 0.5s cubic-bezier(.4,0,.2,1); opacity: 1; }
    .card-hover:hover {
      box-shadow: 0 8px 24px rgba(60, 60, 120, 0.12);
      transform: scale(1.02);
      background: #f8fafc;
    }
    button:hover, input:focus, select:focus {
      box-shadow: 0 2px 8px rgba(99,102,241,0.08);
      border-color: #6366f1;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <div id="syllabusSection" class="bg-white rounded-2xl shadow-xl p-6 card-hover">
    <h2 class="text-2xl font-bold text-indigo-700 mb-4">ðŸ“˜ Syllabus Section</h2>

    <div class="flex space-x-2 mb-4">
      <input id="subjectInput" type="text" placeholder="Enter Subject" class="border p-2 rounded-md w-full" />
      <button id="addSubjectBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">Add</button>
    </div>

    <ul id="subjectList" class="space-y-2"></ul>

    <button id="doneSyllabusBtn" class="mt-6 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">Done</button>
  </div>

  <!-- Popup Modal -->
  <div id="popupModal" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-xl shadow-lg w-11/12 max-w-lg">
      <h3 id="popupTitle" class="text-lg font-bold mb-4">Confirm</h3>
      <div id="popupContent" class="mb-4"></div>
      <div class="flex justify-end space-x-2">
        <button id="popupCancel" class="px-4 py-2 border rounded-lg">Cancel</button>
        <button id="popupOk" class="px-4 py-2 bg-indigo-600 text-white rounded-lg">OK</button>
      </div>
    </div>
  </div>

  <script>
    const subjectInput = document.getElementById("subjectInput");
    const addSubjectBtn = document.getElementById("addSubjectBtn");
    const subjectList = document.getElementById("subjectList");
    const doneSyllabusBtn = document.getElementById("doneSyllabusBtn");

    const popupModal = document.getElementById("popupModal");
    const popupTitle = document.getElementById("popupTitle");
    const popupContent = document.getElementById("popupContent");
    const popupCancel = document.getElementById("popupCancel");
    const popupOk = document.getElementById("popupOk");

    let subjects = [];
    let currentResolve = null;

    function openPopup(title, contentHtml, inputField = true) {
      popupTitle.textContent = title;
      popupContent.innerHTML = inputField
        ? `<input type='text' id='popupInput' class='border p-2 w-full' placeholder='Enter ${title}'>`
        : contentHtml;
      popupModal.classList.remove("hidden");
      return new Promise((resolve) => currentResolve = resolve);
    }

    popupCancel.onclick = () => { popupModal.classList.add("hidden"); currentResolve(null); };
    popupOk.onclick = () => {
      let result;
      const input = document.getElementById("popupInput");
      const selected = document.querySelector("input[name='popupOption']:checked");
      if (input) result = input.value.trim();
      else if (selected) result = selected.value;
      popupModal.classList.add("hidden");
      currentResolve(result || null);
    };

    addSubjectBtn.onclick = async () => {
      const name = subjectInput.value.trim();
      if (!name) return;

      const type = await openPopup("Select Subject Type",
        `<label><input type='radio' name='popupOption' value='major'> Major (4 credits)</label><br>
         <label><input type='radio' name='popupOption' value='minor'> Minor (2 credits)</label>`,
        false);
      if (!type) return;

      const notesLink = await openPopup("Enter Google Drive Notes Link (optional)", "", true);
      let notesName = null;
      if (notesLink) notesName = await openPopup("Enter Display Name for Notes", "", true);

      subjects.push({ name, type, units: [], notesLink, notesName });
      subjectInput.value = "";
      renderSubjects();
    };

    function renderSubjects() {
      subjectList.innerHTML = "";
      subjects.forEach((subj, i) => {
        const li = document.createElement("li");
        li.className = "p-3 bg-gray-50 border rounded-lg hover-actions";
        li.innerHTML = `
          <div class="flex justify-between items-center">
            <div>
              <span class="font-bold text-indigo-700">${subj.name}</span>
              <span class="text-sm text-gray-500">(${subj.type})</span>
              ${subj.notesLink ? `<a href="${subj.notesLink}" target="_blank" class="ml-3 text-blue-600 underline">${subj.notesName || "Notes"}</a>` : ""}
            </div>
            <div class="flex space-x-2">
              <button onclick="editSubject(${i})" class="action-btn text-green-600"><i class='fas fa-pen'></i></button>
              <button onclick="deleteSubject(${i})" class="action-btn text-red-600"><i class='fas fa-times'></i></button>
            </div>
          </div>
          <ul class="ml-6 mt-2 space-y-2">
            ${subj.units.map((u, ui) => `
              <li class="p-2 border rounded-md">
                <div class="flex justify-between items-center">
                  <span class="font-semibold">Unit: ${u.name}</span>
                  <div class="flex space-x-2">
                    <button onclick="editUnit(${i}, ${ui})" class="action-btn text-green-500"><i class='fas fa-pen'></i></button>
                    <button onclick="deleteUnit(${i}, ${ui})" class="action-btn text-red-500"><i class='fas fa-times'></i></button>
                  </div>
                </div>
                <ol class="ml-6 mt-2 list-decimal space-y-1">
                  ${u.topics.map((t, ti) => `
                    <li>
                      <div class="flex justify-between items-center">
                        <span class="font-medium">${t.name}</span>
                        <div class="flex space-x-2">
                          <button onclick="editTopic(${i}, ${ui}, ${ti})" class="action-btn text-green-400"><i class='fas fa-pen'></i></button>
                          <button onclick="deleteTopic(${i}, ${ui}, ${ti})" class="action-btn text-red-400"><i class='fas fa-times'></i></button>
                        </div>
                      </div>
                      <ul class="ml-6 list-disc space-y-1">
                        ${t.subtopics.map((s, si) => `
                          <li>
                            <div class="flex justify-between items-center">
                              <span>${s}</span>
                              <div class="flex space-x-2">
                                <button onclick="editSubtopic(${i}, ${ui}, ${ti}, ${si})" class="action-btn text-green-300"><i class='fas fa-pen'></i></button>
                                <button onclick="deleteSubtopic(${i}, ${ui}, ${ti}, ${si})" class="action-btn text-red-300"><i class='fas fa-times'></i></button>
                              </div>
                            </div>
                          </li>`).join("")}
                      </ul>
                      <button onclick="addSubtopic(${i}, ${ui}, ${ti})" class="text-blue-500">+ Subtopic</button>
                    </li>`).join("")}
                </ol>
                <button onclick="addTopic(${i}, ${ui})" class="text-blue-600 mt-2">+ Topic</button>
              </li>`).join("")}
          </ul>
          <button onclick="addUnit(${i})" class="text-blue-700 mt-2">+ Unit</button>
        `;
        subjectList.appendChild(li);
      });
      localStorage.setItem('syllabusData', JSON.stringify(subjects));
      localStorage.setItem('lastUpdated', new Date().toLocaleString());
    }

    window.addUnit = async (i) => {
      const name = await openPopup("Enter Unit Name");
      if (!name) return;
      subjects[i].units.push({ name, topics: [] });
      renderSubjects();
    };

    window.addTopic = async (i, ui) => {
      const name = await openPopup("Enter Topic Name");
      if (!name) return;
      subjects[i].units[ui].topics.push({ name, subtopics: [] });
      renderSubjects();
    };

    window.addSubtopic = async (i, ui, ti) => {
      const name = await openPopup("Enter Subtopic");
      if (!name) return;
      subjects[i].units[ui].topics[ti].subtopics.push(name);
      renderSubjects();
    };

    window.deleteSubject = (i) => { subjects.splice(i, 1); renderSubjects(); };
    window.deleteUnit = (i, ui) => { subjects[i].units.splice(ui, 1); renderSubjects(); };
    window.deleteTopic = (i, ui, ti) => { subjects[i].units[ui].topics.splice(ti, 1); renderSubjects(); };
    window.deleteSubtopic = (i, ui, ti, si) => { subjects[i].units[ui].topics[ti].subtopics.splice(si, 1); renderSubjects(); };

    doneSyllabusBtn.onclick = () => {
      localStorage.setItem('syllabusData', JSON.stringify(subjects));
      localStorage.setItem('lastUpdated', new Date().toLocaleString());
      alert("âœ… Syllabus saved! Students can now view it.");
    };
  </script>
</body>
</html>
